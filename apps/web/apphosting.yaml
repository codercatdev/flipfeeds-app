# Firebase App Hosting configuration for Next.js
# https://firebase.google.com/docs/app-hosting/configure

runConfig:
  # Cloud Run CPU configuration
  cpu: 1
  # Memory allocation (in GB)
  memoryMiB: 512
  # Maximum number of instances
  maxInstances: 10
  # Minimum number of instances (0 for scale to zero)
  minInstances: 0
  # Request timeout
  concurrency: 80

env:
  # Environment variables for the Next.js app
  - variable: NODE_ENV
    value: production
  
  # Firebase configuration (auto-populated by App Hosting)
  # - variable: FIREBASE_CONFIG
  #   availability: RUNTIME

  # Add your custom environment variables here
  # - variable: NEXT_PUBLIC_FIREBASE_API_KEY
  #   value: your-api-key
  
  # For secrets, use Cloud Secret Manager
  # - variable: SECRET_NAME
  #   secret: secret-id

# Build configuration for pnpm monorepo
# When rootDirectory is set to a subdirectory (apps/web), we need to tell
# Firebase where to find the lock file and how to install dependencies
buildConfig:
  # Install from the repo root where pnpm-lock.yaml exists
  # Use .. to go up from apps/web to the repo root
  installCommand: "cd ../.. && pnpm install --frozen-lockfile"
  
  # Build the Next.js app (will be run from apps/web directory)
  buildCommand: "pnpm build"
